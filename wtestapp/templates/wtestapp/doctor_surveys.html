{% extends 'wtestapp/base.html' %}

{% block title %}Assigned Surveys{% endblock %}

{% block style %}
<style>
  :root{ --teal:#64c5cb; --purple:#c0769e; --pink:#e664a2; --bg:#fdeef4; --card:#ffffff; }
  body{ background: var(--bg); }
  .page-title{ color:var(--purple); font-weight:800; font-size:1.75rem; }
  .survey-list{ display:flex; flex-direction:column; gap:14px; }
  .survey-item{ background:var(--card); border:1px solid var(--pink); border-radius:14px; box-shadow:0 10px 24px rgba(0,0,0,.08); padding:16px 18px; display:flex; align-items:center; justify-content:space-between; }
  .survey-meta{ display:flex; flex-direction:column; gap:4px; }
  .survey-title{ font-weight:700; font-size:1.1rem; color:#7b3f63; margin:0; }
  .survey-desc{ margin:0; color:#8b7b88; font-size:.95rem; }
  .btn-main{ background:var(--pink); border-color:var(--pink); color:#fff; font-weight:600; border-radius:10px; padding:8px 14px; }
  .btn-main:hover{ background:var(--purple); border-color:var(--purple); }
  .empty{ color:#7b3f63; background:#fff; border:1px dashed var(--pink); border-radius:14px; padding:18px; text-align:center; }
  .btn-back{ background: linear-gradient(135deg, #fff 0%, #fdeef4 100%); border: 2px solid var(--pink); color: var(--purple); padding: 10px 24px; font-size: 1.1rem; font-weight: 600; border-radius: 8px; transition: all 0.3s ease; text-decoration: none; display: inline-block; }
  .btn-back:hover{ background: linear-gradient(135deg, var(--pink) 0%, var(--purple) 100%); color: #fff; border-color: var(--purple); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(230, 100, 162, 0.3); }
  .btn-back i { margin-right: 8px; }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="page-title mb-0">Your Assigned Surveys</h2>
    <a href="{% url 'doctor_profile_view' %}" class="btn-back"><i class="fas fa-user"></i> Back to Profile</a>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
  {% endif %}

  {% if surveys %}
    <div class="survey-list">
      {% for survey in surveys %}
        <div class="survey-item">
          <div class="survey-meta">
            <h5 class="survey-title">{{ survey.title }}</h5>
            {% if survey.description %}
              <p class="survey-desc">{{ survey.description|truncatechars:140 }}</p>
            {% endif %}
            {% if survey.id in completed_surveys %}
              <span style="color:#2e7d32; font-size:.9rem;"><i class="fas fa-check-circle"></i> Completed</span>
            {% endif %}
          </div>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            {% if survey.id in completed_surveys %}
              <a href="{% url 'survey_detail' survey.id %}?view=1" class="btn btn-outline-secondary" style="border-color:#64c5cb; color:#64c5cb;"><i class="fas fa-eye"></i> View</a>
            {% else %}
              <a href="{% url 'survey_detail' survey.id %}" class="btn btn-main">Take Survey</a>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="empty">
      <p style="margin-bottom: 15px;">No surveys assigned yet.</p>
      {% if last_survey_url %}
        <a href="{{ last_survey_url }}" class="btn btn-main">View last submitted survey</a>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}
